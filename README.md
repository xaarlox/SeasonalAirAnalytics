# SeasonalAirAnalytics

## Завдання
Аналітика по якості повітря - візуалізація (коли можна алергикам виходити, коли берегтись, як змінюється в залежності від сезону, чи є зв’язок з іншими параметрами погоди).

## Вступ
У цій лабораторній роботі було використано [датасет](https://www.kaggle.com/datasets/nelgiriyewithana/global-weather-repository), який надає щоденну інформацію про погоду для столиць світу. За посиланням можна детально ознайомитися з інформацією про даний датасет. Було використано `pandas`, оскільки це стандартна бібліотека для аналізу та обробки табличних даних, `matplotlib.pyplot` для побудови графіків, `seaborn` для швидкої будови статистичних графіків з гарнішим оформленням, а `plotly.express` для будови карт з інтерактивною візуалізацією.

## Хід роботи
### Крок 1
Спершу було завантажено дані за допомогою команди `df = pd.read_csv(r"C:\lab3\GlobalWeatherRepository.csv")` та виведення на екран `df`. Отримали наступну таблицю:

![image](https://github.com/user-attachments/assets/30428620-e49a-4113-97d1-30fa56134259)

Як можемо бачити з зображення, дана таблиця містить 63533 рядки та 41 колонку.

### Крок 2
При первинному перегляді було виявлено приклад неякісних або непослідовних даних. Зокрема, спроба відібрати записи з міста Sanaa, які не мають позначення країни як Yemen за допомогою запиту `df[df.country != 'Yemen'][df.location_name == 'Sanaa']`, виявила такий фрагмент:

![image](https://github.com/user-attachments/assets/f530b902-6483-4614-8b55-9b57bb21bbfa)

Це показало, що у датасеті можуть бути логічні суперечності або помилки заповнення, як-от:
+ некоректна країна для відомого міста;
+ дублікати записів із різними значеннями;
+ можливі автоматично згенеровані або відсутні значення.

Такі випадки є типовими для великих реальних датасетів, і потребують попередньої перевірки, фільтрації або обробки перед подальшим аналізом (Data Cleaning).

### Крок 3
За допомогою команд `df.last_updated.min()`, `df.last_updated.max()` було визначено початок періоду збору даних та найсвіжіші оновлення у таблиці. Також було написано запит `pd.set_option('display.max.columns', 41)`, який налаштовує pandas так, щоб при виведенні таблиць у Jupyter Notebook відображалася 41 колонка замість 20.

### Крок 4
Переглядаючи датасет, було виявлено, що для кожного міста або координат часто є декілька записів з різними датами. Щоб аналізувати лише найактуальніші дані, було написано наступні запити:

* `df_sorted = df.sort_values(by=['latitude', 'longitude', 'last_updated'], ascending=[True, True, False])`- запит, який згрупував записи за географічними координатами (latitude, longitude) - тобто, по кожному унікальному місцю, а всередині кожної групи на першому місці був запис з найновішим оновленням (last_updated у спадному порядку).
* `df_unique = df_sorted.drop_duplicates(subset=['latitude', 'longitude'], keep='first')` - запит, який видалив дублікати координат, залишивши тільки найсвіжіший запис. Результат:

![image](https://github.com/user-attachments/assets/dc280dac-42e6-43ad-b665-dc346a60cb23)

Бачимо, що тепер таблиця містить 424 рядки. Це свідчить про те, що було отримано по одному найактуальнішому запису для кожної локації.

### Крок 5
Для подальшої роботи було вирішено написати запити, котрі використовуються для структуризації даних: спочатку переглянуто всі колонки, а потім сформовано новий датафрейм із тими, що мають безпосереднє значення для дослідження якості повітря та погоди в різних містах.
Запити:
+ `df_unique.columns` - повертає список усіх назв колонок у датафреймі df_unique;
+ `df_air = df_unique[['country','location_name','latitude', 'longitude','temperature_celsius','condition_text','humidity', 'cloud', 'wind_kph', 'gust_kph', 'air_quality_Carbon_Monoxide', 'air_quality_Ozone', 'air_quality_Nitrogen_dioxide', 'air_quality_Sulphur_dioxide', 'air_quality_PM2.5', 'air_quality_PM10', 'air_quality_us-epa-index', 'air_quality_gb-defra-index']]` - створює новий датафрейм df_air, який містить тільки найважливіші стовпці.

### Крок 6
Було написано запит (`df_air[['air_quality_Carbon_Monoxide', 'air_quality_Ozone', 'air_quality_Nitrogen_dioxide', 'air_quality_Sulphur_dioxide', 'air_quality_PM2.5', 'air_quality_PM10']].describe()`) для отримання базової статистики (мінімум, максимум, середнє, медіану, квартилі) для ключових речовин, які впливають на якість повітря. Результат запиту:

![image](https://github.com/user-attachments/assets/5bd3dfbf-0723-4368-a2dc-0644c4bb26e3)

У колонці `air_quality_Carbon_Monoxide` було зафіксовано аномально великі значення, які не мають пояснень в описі датасету, зокрема:
- незрозумілий діапазон (якщо повернутися до початково датафрейму, то можна побачити, що ця колонка має діапазон від -10 000 до 38 000);
- відсутність інформації про одиниці виміру.

Через це було вирішено не використовувати окремі концентрації забруднювачів, оскільки невідомо, як інтерпретувати їх значення, і це лише ускладнило б аналіз та могло би ввести в оману при візуалізації. Натомість для подальшого аналізу було використано вже обраховані індекси якості повітря, які надають узагальнене уявлення про стан атмосфери. Запит - `df_air[['air_quality_us-epa-index', 'air_quality_gb-defra-index']].describe()`. Результат:

![image](https://github.com/user-attachments/assets/75559132-3e27-4560-a6cd-dac6f08bff2e)

*Трохи теорії.*

Індекс [US EPA](https://www.airnow.gov/aqi/aqi-basics/) враховує 5 основних забруднювачів, які мають встановлені граничні норми:
* ground-level ozone;
* particle pollution (включаючи PM2.5 та PM10);
* carbon monoxide;
* sulfur dioxide;
* nitrogen dioxide.

Індекс [GB-DEFRA (DAQI)](https://uk-air.defra.gov.uk/air-pollution/daqi?view=more-info) визначає загальний рівень забруднення за максимальним значенням одного з 5 показників:
* nitrogen dioxide;
* sulphur dioxide
* ozone;
* PM2.5;
* PM10.

Оскільки в датасеті вже є ці індекси, то було прийнято рішення видалити зайві колонки, що дозволило спростити подальший аналіз, уникнути плутанини з одиницями виміру та зосередитись на інтерпретованих, узагальнених індикаторах якості повітря.

### Крок 7
Було створено нову колонку `is_safe_for_allergic`, яка надалі буде логічним індикатором, що вказує, чи є повітря умовно безпечним для людей із підвищеною чутливістю до забруднення (зокрема - для алергіків). Це було реалізовано за допомогою наступного запиту:
`df_air['is_safe_for_allergic'] = ((df_air['air_quality_us-epa-index'] <= 2) & (df_air['air_quality_gb-defra-index'] <= 3))`

Результат:

![image](https://github.com/user-attachments/assets/8a790397-2bfa-4825-adf3-c38e5394ce50)

### Крок 8
Після створення логічної змінної `is_safe_for_allergic`, яка позначає, чи є якість повітря умовно безпечною для алергіків, було реалізовано географічну візуалізацію за допомогою інтерактивної карти:

![image](https://github.com/user-attachments/assets/9ff0a3cb-3948-47ce-86ae-dc55e23134b4)

Ця картка показує просторовий розподіл безпечних і небезпечних місць для алергіків і дозволяє візуально порівняти регіони.

### Крок 9
Наступний крок - аналіз зв’язку між погодними умовами та безпекою для алергіків. Реалізовано кореляційну матрицю.

![image](https://github.com/user-attachments/assets/0ff5851f-fe20-42af-9efd-d15da5c7e3dc)

*Опис результатів.* З матриці видно, що вплив на `is_safe_for_allergic`:
+ humidity: **помірна позитивна кореляція (0.31)**. Чим вища вологість, тим імовірніше, що повітря буде безпечним для алергіків.
+ cloud: **помірний зв’язок (0.25)**. Похмура погода частково асоціюється з кращою якістю повітря.
+ temperature_celsius: **негативна кореляція (-0.27)**. Вища температура дещо знижує безпечність для алергіків.
+ wind_kph і gust_kph: **дуже слабкий негативний зв'язок**. Це свідчить про те, що швидкість вітру та пориву не мають суттєвого впливу на змінну `is_safe_for_allergic`.

Також з даної матриці можемо бачити взаємозв’язки між погодними змінними:
+ wind_kph та gust_kph: **сильна позитивна кореляція (0.93)**. Чим сильніший вітер, тим сильніші й пориви.
+ humidity і cloud: **помірна кореляція (0.53)**. Вологіші регіони зазвичай мають більше хмарності.

### Крок 10
Щоб дослідити сезонні зміни якості повітря та погодних умов і побачити, як вони впливають на екологічну безпеку для алергіків, було написано наступні запити:
- `df_seasons = df` - копія основного датафрейму df для подальших обчислень, щоб не змінювати оригінальні дані;
- `df_seasons['last_updated'] = pd.to_datetime(df_seasons['last_updated'])` - перетворення стовпця `last_updated` (дата й час останнього оновлення даних) у формат `datetime`, щоб з ним можна було працювати як із датами.
- `df_seasons['month'] = df_seasons['last_updated'].dt.month` - витягнення місяця з дати в новий стовпець `month`, що дозволяє проводити аналіз за сезонами або місяцями року.
- `df_seasons = df_seasons[['country','location_name','month','temperature_celsius','humidity', 'cloud', 'wind_kph', 'air_quality_us-epa-index', 'air_quality_gb-defra-index']]` - за допмогою цього запиту було вибрано тільки релевантні змінні, які стосуються погодних умов та індексів якості повітря для подальшого аналізу.
- Було створено колонку `is_safe_for_allergic` (аналогічну до колонки з `df_air`).

Результат попередніх запитів:

![image](https://github.com/user-attachments/assets/cc0b77ec-d42d-4a74-9845-17bbc955b0bb)

### Крок 11
На основі попереднього датафрейму було створено графік для візуального аналізу сезонної безпеки для людей з алергією протягом року. Він допомагає визначити, в які місяці переважають безпечні або небезпечні дні. Це може бути корисним для:
* планування подорожей або активностей для алергіків;
* попереджень про потенційні ризики;
* виявлення сезонних закономірностей алергенів (наприклад, пилок весною або пліснява восени).

Створений графік:

![image](https://github.com/user-attachments/assets/c04b7153-3221-43af-a219-2fd569c5cfd9)

### Крок 12
Було створено новий датафрейм df_ukraine, який містить лише ті рядки з df_seasons, де країна - Україна. Також було побудовано графік аналогічно до попереднього, але він використовує лише дані з української частини вибірки.

Графік:

![image](https://github.com/user-attachments/assets/5582e92e-fa52-47ba-96ca-3cd654af33a0)
